<!doctype html>
<html>
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

		<title>自己紹介LT</title>

        <script src="js/makedom.js"></script>
		<link rel="stylesheet" href="css/reveal.css">
		<link rel="stylesheet" href="css/theme/black.css">

		<!-- Theme used for syntax highlighting of code -->
		<link rel="stylesheet" href="lib/css/zenburn.css">

		<!-- Printing and PDF exports -->
		<script>
			var link = document.createElement( 'link' );
			link.rel = 'stylesheet';
			link.type = 'text/css';
			link.href = window.location.search.match( /print-pdf/gi ) ? 'css/print/pdf.css' : 'css/print/paper.css';
			document.getElementsByTagName( 'head' )[0].appendChild( link );
		</script>
	</head>
	<body>
        <!-- ファーストロードでサーバーからのファイル受信をを順序指定非同期で開始  -->
		<div class="reveal">
			<div class="slides">
                <section>
                    <h2 class="title"></h2>
                    <h3 class="name"></h3>
                    <h4 class="date"></h4>
                    <span></span>
                    <a class="url"></a>
                    <p><small>Powered by Reveal.js, GoogleAppScript</small></p>
                </section>
                <section>
                    <div class="image"></div>
                    <h3 class="name"></h3>
                    <div class="collge"></div>
                    <div class="department"></div>
                    <div class="cource grade description"></div>
                    <div class="born"></div>


                </section>
				<section data-markdown data-separator="---$" data-separator-vertical=">>>$">
                    <script id = "slideurl" type="text/template"></script>
                </section>
                
                <section>
                    <p>End</p>
                    <p></p>
                    <p>このスライドのURL</p>
                    <a class="url"></a>
                </section>
			</div>
		</div>

		<script src="lib/js/head.min.js"></script>
		<script src="js/reveal.js"></script>
		<script>
			// More info about config & dependencies:
			// - https://github.com/hakimel/reveal.js#configuration
			// - https://github.com/hakimel/reveal.js#dependencies
            ///URL parameter取得して配列へin
            var arg = getURLparam(location.search.substring(1).split('&'));
            ///プロフィールAPI(自作GASアプリ)より取得
            var url = "https://script.google.com/macros/s/AKfycbyulXVm6rcR8YOHtDJ-E4v22fkzMGeSKbUU7UCbwn-rttQwVn89/exec";
            var param = {};
            param["mode"]=arg["mode"];
            param = JSON.stringify(param);
            console.log("0");
            fetch(url,{
                method: 'POST',
                mode: 'cors',
                body: param
            }).then(function(response) {
                return response.text();
            }).then(function(json) {
                var json = JSON.parse(json||"null");
                console.log(json);
                return json;
            }).then(json => createDom(json)
            ).then(function(json){
                console.log("open the price:"+json["slideurl"]);
                fetch(json["slideurl"]).then(function(response) {
                    return response.text();
                }).then(function(slidebody){
                    console.log(slidebody);
                    document.getElementById("slideurl").insertAdjacentHTML("beforeend", ""+ slidebody +"");
                    return true;
                }).then(function(ok){
                    console.log(ok);
                    if(ok){
                        console.log("reveal initializing///");
                        Reveal.initialize(
                            {
                                dependencies: [
                                    { src: 'plugin/markdown/marked.js' },
                                    { src: 'plugin/markdown/markdown.js' },
                                    { src: 'plugin/notes/notes.js', async: true },
                                    { src: 'plugin/highlight/highlight.js', async: true, callback: function() { hljs.initHighlightingOnLoad(); } }
                                ]
                            }
                        );
                    }
                });
            });
        </script>
	</body>
</html>
